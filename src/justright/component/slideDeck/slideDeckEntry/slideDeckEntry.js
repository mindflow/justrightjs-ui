import { TimePromise } from "coreutil_v1";
import { BaseElement, CanvasStyles, Component, ComponentFactory, CSS } from "justright_core_v1";
import { InjectionPoint } from "mindi_v1";

export class SlideDeckEntry {

    static get COMPONENT_NAME() { return "SlideDeckEntry"; }
    static get TEMPLATE_URL() { return "/assets/justrightjs-ui/slideDeckEntry.html"; }
    static get STYLES_URL() { return "/assets/justrightjs-ui/slideDeckEntry.css"; }

    static get DEFAULT_CLASS() { return "slide-deck-entry"; }

    static get ENTRY_POSITION_FRONT() { return "entry-position-front" };
    static get ENTRY_POSITION_BEHIND() { return "entry-position-behind" };
    static get ENTRY_POSITION_RIGHT() { return "entry-position-right" };

    static get CONTENT_EXISTANCE_PRESENT() { return "content-existance-present" };
    static get CONTENT_EXISTANCE_REMOVED() { return "content-existance-removed" };

    constructor() {
        /** @type {ComponentFactory} */
        this.componentFactory = InjectionPoint.instance(ComponentFactory);

        /** @type {Component} */
        this.component = null;

        /** @type {Number} */
        this.index = 0;

        this.position = SlideDeckEntry.ENTRY_POSITION_FRONT;
    }

    /**
     * @returns {BaseElement}
     */
    get contentElement() {
        return this.component.get("slideDeckEntryContent");
    }

    /**
     * @returns {BaseElement}
     */
    get entryElement() {
        return this.component.get("slideDeckEntry");
    }

    async postConfig() {
        this.component = this.componentFactory.create(SlideDeckEntry.COMPONENT_NAME);
        CanvasStyles.enableStyle(SlideDeckEntry.COMPONENT_NAME);
    }

    setIndex(index) {
        this.index = index;
    }

    setContent(component) {
        this.contentElement.setChild(component);
    }

    show() {
        this.setContentVisibility(SlideDeckEntry.CONTENT_EXISTANCE_PRESENT);
        this.setShift(SlideDeckEntry.ENTRY_POSITION_FRONT);
    }

    hide(nextIndex) {
        if (nextIndex > this.index) {
            this.setShift(SlideDeckEntry.ENTRY_POSITION_BEHIND);
        } else {
            this.setShift(SlideDeckEntry.ENTRY_POSITION_RIGHT);
        }
        this.adjustWhenHidden();
    }

    adjustWhenHidden() {
        TimePromise.asPromise(600, () => {
            if (this.position === SlideDeckEntry.ENTRY_POSITION_FRONT) {
                return;
            }
            this.setContentVisibility(SlideDeckEntry.CONTENT_EXISTANCE_REMOVED);
        });
    }

    setContentVisibility(contentVisibility) {
        CSS.from(this.contentElement).replace("content-existance-", contentVisibility);
    }

    setShift(position) {
        this.position = position;
        CSS.from(this.entryElement).replace("entry-position-", position);
    }

}